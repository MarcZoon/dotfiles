{{ if eq .chezmoi.os "linux" -}}
#!/bin/bash

if [ -f /etc/os-release ]; then
    . /etc/os-release
    distro=$ID
else
    echo "Cannot detect OS. /etc/os-release not found."
    exit 1
fi

case "$distro" in
    ubuntu)
        sudo apt update
        sudo apt install -y {{ range .packages.apt -}} {{ . | quote }} {{ end -}}
        ;;
    debian)
        sudo apt update
        sudo apt install -y {{ range .packages.apt -}} {{ . | quote }} {{ end -}}
	    ;;
    arch)
        sudo pacman -Sy
        ;;
    *)
        echo "Unsupported distribution: $distro"
	exit 1
	;;
esac

# Install NVM and node
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
nvm use {{ .versions.node }}

# Install global npm packages
{{- range .packages.npm }}
npm install -g {{ . | quote }}
{{- end }}


{{ end -}}
